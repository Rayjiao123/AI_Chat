<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='style.css') }}">
    
</head>

<body>
    <h1 style="text-align: center; color: green;">Ray's Robo-Advicer Chatbot {{room}}</h1>

    <img src="../static/img/ROBO.jpg" alt="Super Robot" width="50%" style = "display:block; margin-left: auto; margin-right: auto;">

    <p style="text-align: center; padding-left: 10%;padding-right: 10%; color: green;">Disclaimer: The currently available topics are limited to, <strong> 1. what stocks to buy; 2. stocks to gamble on with high returns; 
       3. whether TSLA is a good stock; 4. Amazon stock; 5. outlook for stock market in 2021; and 6. a fun question about how good I am:) </strong> </p>    
    <div id="messages" style="text-align: center; font-size: large;"></div>
    <br>
    <br>
    <form id='message_input_form' style="text-align: center;">
        <input type="text" placeholder="Enter your message here" id="message_input">
        <button type="submit">Send</button>
    </form>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous"></script>
<script>
    const socket = io.connect("http://127.0.0.1:5000/")

    // Event handler for new connections.
    // The callback function is invoked when a connection with the
    // server is established.
    socket.on('connect', function() {
        socket.emit('my_event', {
            data: 'I\'m connected!'
        });
    });

    let message_input = document.getElementById('message_input')

    document.getElementById('message_input_form').onsubmit = function(e) {
        e.preventDefault();
        let message = message_input.value

        if (message.length) {
            const newNode = document.createElement('div')
            newNode.innerHTML = `<b>Your question:</b> ${message}`
            document.getElementById('messages').appendChild(newNode);

            socket.emit('send_message', {
                message: message
            })

            message_input.value = '';
        }
        message_input.focus();
        return false;
    }

    socket.on('reply_message', function(data) {
        console.log(data);
        const linebreak = document.createElement('br')
        const newNode = document.createElement('div')
        newNode.innerHTML = `<b>${"Ray's Robo-Advicer: "}</b> ${data.message}`
        document.getElementById('messages').appendChild(newNode)
        document.getElementById('messages').appendChild(linebreak);
        
    })
</script>

</html>